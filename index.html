<!doctype html>
<html lang="hy">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Auth — Debug</title>
<style>
  body{font-family:Arial;display:flex;align-items:center;justify-content:center;height:100vh;background:#f4f7fb;margin:0}
  .card{width:360px;background:white;padding:20px;border-radius:12px;box-shadow:0 8px 30px rgba(11,22,40,0.08)}
  input{width:100%;padding:10px;margin-top:8px;border:1px solid #ddd;border-radius:8px}
  .row{display:flex;gap:8px;margin-top:12px}
  button{flex:1;padding:10px;border-radius:8px;border:0;cursor:pointer}
  .primary{background:#007bff;color:white}
  .ghost{background:#e9eef7}
  .msg{margin-top:12px;min-height:20px}
  .error{color:#b00020}
  .ok{color:#007b23}
  .hint{font-size:13px;color:#666;margin-top:8px}
  .warn{background:#fff3cd;border-radius:8px;padding:8px;margin-top:8px;color:#665c00}
</style>
</head>
<body>
<div class="card">
  <h3 id="title">Գրանցում</h3>

  <label>Էլ․ հասցե</label>
  <input id="email" type="email" placeholder="you@example.com">

  <label style="margin-top:8px">Գաղտնաբառ</label>
  <input id="password" type="password" placeholder="Գաղտնաբառ">

  <div class="row">
    <button id="submitBtn" class="primary">Գրանցվել</button>
    <button id="toggleBtn" class="ghost">Մուտք</button>
  </div>

  <div class="msg" id="msg"></div>

  <div class="hint">Նշում: Սա WebApp պետք է բացել **Telegram** հավելվածում (ոչ սովորական բրաուզերում). Եթե տեքստը տեսնեք՝ բացվել է առանց Telegram:</div>
  <div id="tgCheck" class="warn" style="display:none"></div>
</div>

<script>
  const maybeTg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
  const msgEl = document.getElementById("msg");
  const tgCheck = document.getElementById("tgCheck");

  function setMsg(text, cls){
    msgEl.textContent = text;
    msgEl.className = "msg " + (cls||"");
  }

  if(!maybeTg){
    tgCheck.style.display = "block";
    tgCheck.textContent = "ՏԵՂՑԱՐԿՎԱԾ չէ Telegram WebApp API — սա նշանակում է էջը բացվել է ոչ Telegram-ի մեջ և sendData չի աշխատի։ Բացեք էջը սեղմելով բոտի WebApp կոճակը (Telegram).";
    // disable buttons:
    document.getElementById("submitBtn").disabled = true;
    document.getElementById("toggleBtn").disabled = true;
  } else {
    try { maybeTg.expand(); } catch(e) {}
  }

  let mode = "register";
  document.getElementById("toggleBtn").addEventListener("click", ()=>{
    mode = mode==="register" ? "login" : "register";
    document.getElementById("title").textContent = mode==="register" ? "Գրանցում" : "Մուտք";
    document.getElementById("submitBtn").textContent = mode==="register" ? "Գրանցվել" : "Մուտք";
    setMsg("");
  });

  document.getElementById("submitBtn").addEventListener("click", ()=>{
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;
    if(!email || !password){ setMsg("Լրացրեք բոլոր դաշտերը", "error"); return; }

    const payload = { action: mode, email, password };

    if(!maybeTg){
      // fallback: show payload so user can see it's prepared
      setMsg("DEBUG: պատրաստվում է ուղարկել payload (բայց tg չկա). Դիտեք console:", "error");
      console.log("DEBUG payload:", payload);
      return;
    }

    try {
      // show debug message
      setMsg("Ուղարկվում է բоту...", "ok");
      maybeTg.sendData(JSON.stringify(payload));
      // note: sendData չի ներմուծում synchronous պատասխան — պատասխանը կգա Telegram message-ում
      setMsg("✅ Տվյալները ուղարկվեցին: Ստուգեք բոտի պատասխանը Telegram-ում։", "ok");
    } catch(err){
      console.error("sendData error:", err);
      setMsg("❌ Առաջացավ սխալ sendData-ի ժամանակ: Console-ում տես նկարը", "error");
    }
  });
</script>
</body>
</html>
